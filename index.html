<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Gerador de Relatório PM</title>

    <style>
         :root {
            --app-width: 760px;
            --card-radius: 26px;
        }
        
        * {
            box-sizing: border-box
        }
        
        body {
            margin: 0;
            font-family: Arial, Helvetica, sans-serif;
            background: #f2f4f6;
            display: flex;
            justify-content: center;
            padding: 24px;
        }
        
        .app {
            width: var(--app-width);
            max-width: 100%;
        }
        /* ---------------- FORM ---------------- */
        
        .form {
            background: #fff;
            padding: 12px 14px;
            border-radius: 10px;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.06);
            margin-bottom: 18px;
        }
        
        .form-row {
            display: flex;
            gap: 10px;
            margin-bottom: 8px;
        }
        
        .form-row .col {
            flex: 1
        }
        
        label {
            font-size: 13px;
            color: #333;
            display: block;
            margin-bottom: 6px;
        }
        
        input[type="text"],
        input[type="date"],
        input[type="file"] {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid #d8dbe0;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .actions {
            display: flex;
            gap: 10px;
            margin-top: 10px
        }
        
        button {
            cursor: pointer;
            background: #1f6feb;
            color: white;
            border: none;
            padding: 10px 14px;
            border-radius: 8px;
            font-weight: 600;
        }
        
        button.secondary {
            background: #6b7280
        }
        /* ---------------- PREVIEW ---------------- */
        
        .preview {
            position: relative;
            width: 100%;
        }
        
        .photo {
            width: 100%;
            height: 520px;
            object-fit: cover;
            border-radius: 14px;
            display: block;
            background: #ccc;
        }
        /* ---------------- MODAL ---------------- */
        
        .card {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            top: 360px;
            background: #fff;
            width: 92%;
            border-radius: var(--card-radius);
            padding: 26px 30px;
            box-shadow: 0 18px 34px rgba(0, 0, 0, 0.25);
            z-index: 20;
            text-align: center;
            /* CENTRALIZA TUDO */
        }
        /* ---------------- CABEÇALHO ENTRE LOGOS ---------------- */
        
        .header-wrap {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 18px;
        }
        
        .header-wrap img {
            height: 78px;
        }
        
        .header-center {
            flex: 1;
            text-align: center;
            margin: 0 12px;
        }
        
        .title {
            font-weight: 800;
            font-size: 20px;
            margin: 0;
        }
        
        .sub {
            font-size: 17px;
            margin-top: 3px;
        }
        /* ---------------- GRID ---------------- */
        
        .grid {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            /* CENTRALIZA OS CAMPOS */
            text-align: center;
            /* CENTRALIZA TEXTO DOS CAMPOS */
        }
        
        .field.full {
            flex-basis: 100% !important;
            width: 100%;
            text-align: center;
        }
        
        .field {
            flex: 1 1 44%;
            min-width: 220px;
            text-align: center;
            /* CENTRALIZA INDIVIDUALMENTE */
        }
        
        .label-small {
            font-size: 13px;
            color: #555;
            margin-bottom: 4px;
            text-align: center;
        }
        
        .value {
            font-size: 16px;
            font-weight: 700;
            padding-bottom: 8px;
            border-bottom: 1px solid #ddd;
            color: #111;
            word-break: break-word;
            text-align: center;
            /* CENTRALIZA TEXTO DO VALOR */
        }
        /* ---------------- DOWNLOAD AREA ---------------- */
        
        .download-row {
            display: flex;
            justify-content: center;
            margin-top: 500px;
            gap: 10px;
        }
    </style>
</head>

<body>

    <div class="app">

        <!-- FORM ----------------------------------------------------------- -->
        <div class="form" id="form">

            <!-- PRIMEIRA LINHA — SOMENTE NOME -->
            <div class="form-row">
                <div class="col" style="flex: 1;">
                    <label for="nome">Nome</label>
                    <input id="nome" type="text" placeholder="Nome completo">
                </div>
            </div>

            <!-- SEGUNDA LINHA -->
            <div class="form-row">
                <div class="col">
                    <label for="unidade">Unidade</label>
                    <input id="unidade" type="text" placeholder="EQUIPE CFP NOTURNA">
                </div>
                <div class="col">
                    <label for="rg">RG</label>
                    <input id="rg" type="text">
                </div>
            </div>

            <!-- TERCEIRA LINHA -->
            <div class="form-row">
                <div class="col">
                    <label for="nascimento">Nascimento</label>
                    <input id="nascimento" type="date">
                </div>
                <div class="col">
                    <label for="ocorrencia">Ocorrência</label>
                    <input id="ocorrencia" type="text">
                </div>
            </div>

            <!-- QUARTA LINHA -->
            <div class="form-row">
                <div class="col">
                    <label for="local">Local</label>
                    <input id="local" type="text">
                </div>
                <div class="col">
                    <label for="bopm">BOPM</label>
                    <input id="bopm" type="text">
                </div>
            </div>

            <!-- QUINTA LINHA -->
            <div class="form-row">
                <div class="col">
                    <label for="bopc">BOPC</label>
                    <input id="bopc" type="text">
                </div>
                <div class="col">
                    <label for="equipe">Equipe / Viatura</label>
                    <input id="equipe" type="text">
                </div>
            </div>

            <!-- SEXTA LINHA -->
            <div class="form-row">
                <div class="col">
                    <label for="data">Data</label>
                    <input id="data" type="date">
                </div>
                <div class="col">
                    <label for="imgInput">Foto principal</label>
                    <input id="imgInput" type="file" accept="image/*">
                </div>
            </div>

            <div class="actions">
                <button id="btnPreview" type="button">Atualizar Prévia</button>
                <button id="btnClear" class="secondary" type="button">Limpar</button>
            </div>

        </div>

        <!-- PREVIEW --------------------------------------------------------- -->
        <div class="preview" id="previewArea">

            <img id="photo" class="photo">

            <div id="reportCard" class="card">

                <div class="header-wrap">
                    <img src="img/logo22.png">
                    <div class="header-center">
                        <div class="title">POLÍCIA MILITAR DO ESTADO DE SÃO PAULO</div>
                        <div id="r_unidade" class="sub">EQUIPE CFP NOTURNA</div>
                    </div>
                    <img src="img/logopm.png">
                </div>

                <div class="grid">

                    <!-- NOME EM LINHA ÚNICA E CENTRALIZADO -->
                    <div class="field full">
                        <div class="label-small">Nome:</div>
                        <div id="r_nome" class="value"></div>
                    </div>

                    <div class="field">
                        <div class="label-small">RG:</div>
                        <div id="r_rg" class="value"></div>
                    </div>

                    <div class="field">
                        <div class="label-small">Nascimento:</div>
                        <div id="r_nascimento" class="value"></div>
                    </div>

                    <div class="field">
                        <div class="label-small">Ocorrência:</div>
                        <div id="r_ocorrencia" class="value"></div>
                    </div>

                    <div class="field">
                        <div class="label-small">Local:</div>
                        <div id="r_local" class="value"></div>
                    </div>

                    <div class="field">
                        <div class="label-small">Equipe/Viatura:</div>
                        <div id="r_equipe" class="value"></div>
                    </div>

                    <div class="field">
                        <div class="label-small">BOPM:</div>
                        <div id="r_bopm" class="value"></div>
                    </div>

                    <div class="field">
                        <div class="label-small">BOPC:</div>
                        <div id="r_bopc" class="value"></div>
                    </div>

                    <div class="field full">
                        <div class="label-small">Data:</div>
                        <div id="r_data" class="value"></div>
                    </div>

                </div>
            </div>
        </div>

        <div class="download-row">
            <button id="btnDownload">Baixar JPEG</button>
            <button id="btnDownloadPDF" class="secondary">Abrir em PDF</button>
        </div>

    </div>

    <!-- html2canvas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <script>
        const elems = {
            unidade,
            nome,
            rg,
            nascimento,
            ocorrencia,
            local,
            bopm,
            bopc,
            equipe,
            data,
            imgInput,
            photo,
            previewArea
        };

        const targets = {
            r_unidade,
            r_nome,
            r_rg,
            r_nascimento,
            r_ocorrencia,
            r_local,
            r_bopm,
            r_bopc,
            r_equipe,
            r_data
        };

        function formatDate(iso) {
            if (!iso) return "";
            const p = iso.split("-");
            return `${p[2]}/${p[1]}/${p[0]}`;
        }

        function atualizarPreview() {
            targets.r_unidade.textContent = elems.unidade.value || "EQUIPE CFP NOTURNA";
            targets.r_nome.textContent = elems.nome.value;
            targets.r_rg.textContent = elems.rg.value;
            targets.r_nascimento.textContent = elems.nascimento.value ? formatDate(elems.nascimento.value) : "";
            targets.r_ocorrencia.textContent = elems.ocorrencia.value;
            targets.r_local.textContent = elems.local.value;
            targets.r_bopm.textContent = elems.bopm.value;
            targets.r_bopc.textContent = elems.bopc.value;
            targets.r_equipe.textContent = elems.equipe.value;
            targets.r_data.textContent = elems.data.value ? formatDate(elems.data.value) : "";
        }

        document.querySelectorAll("#form input").forEach(input =>
            input.addEventListener("input", atualizarPreview)
        );

        imgInput.addEventListener("change", e => {
            const f = e.target.files[0];
            if (!f) return;
            const reader = new FileReader();
            reader.onload = ev => photo.src = ev.target.result;
            reader.readAsDataURL(f);
        });

        btnClear.addEventListener("click", () => {
            document.querySelectorAll("#form input[type=text], #form input[type=date]").forEach(i => i.value = "");
            imgInput.value = "";
            photo.src = "";
            atualizarPreview();
        });

        async function captureNodeAsBlob(node, scale = 3) {
            await new Promise(r => setTimeout(r, 150));
            const canvas = await html2canvas(node, {
                scale,
                useCORS: true
            });
            return new Promise(resolve => canvas.toBlob(resolve, "image/jpeg", 0.95));
        }

        btnDownload.addEventListener("click", async() => {
            const blob = await captureNodeAsBlob(previewArea, 3);
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "relatorio_pm.jpg";
            a.click();
            URL.revokeObjectURL(url);
        });

        btnDownloadPDF.addEventListener("click", async() => {
            const blob = await captureNodeAsBlob(previewArea, 2);
            const url = URL.createObjectURL(blob);
            const w = window.open("", "_blank");
            w.document.write(`<img src="${url}" style="width:100%">`);
            w.document.close();
        });

        atualizarPreview();
    </script>

</body>

</html>