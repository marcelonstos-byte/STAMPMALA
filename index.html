<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Gerador de Relatório PM</title>

    <style>
         :root {
            --app-width: 760px;
            --card-radius: 26px;
        }
        
        * {
            box-sizing: border-box;
        }
        
        body {
            margin: 0;
            font-family: Arial, Helvetica, sans-serif;
            background: #f2f4f6;
            display: flex;
            justify-content: center;
            padding: 24px;
        }
        
        .app {
            width: var(--app-width);
            max-width: 100%;
        }
        /* ---------------- FORM ---------------- */
        
        .form {
            background: #fff;
            padding: 12px 14px;
            border-radius: 10px;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.06);
            margin-bottom: 18px;
        }
        
        .form-row {
            display: flex;
            gap: 10px;
            margin-bottom: 8px;
        }
        
        .form-row .col {
            flex: 1;
        }
        
        label {
            font-size: 13px;
            color: #333;
            display: block;
            margin-bottom: 6px;
        }
        
        input[type="text"],
        input[type="date"],
        input[type="file"] {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid #d8dbe0;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        button {
            cursor: pointer;
            background: #1f6feb;
            color: white;
            border: none;
            padding: 10px 14px;
            border-radius: 8px;
            font-weight: 600;
        }
        
        button.secondary {
            background: #6b7280;
        }
        /* ---------------- PREVIEW ---------------- */
        
        .preview {
            width: 100%;
            border-radius: 18px;
            overflow: hidden;
            position: relative;
            aspect-ratio: 3 / 4;
            /* garante proporção consistente */
            background: #000;
        }
        /* IMAGEM PRINCIPAL — MODO B (cover sem distorcer) */
        
        .photo {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            /* preenche tudo sem esticar */
            z-index: 5;
        }
        /* CARD SOBREPOSTO */
        
        .card {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: calc(100% - 64px);
            border-radius: var(--card-radius);
            background: #fff;
            padding: 26px 30px;
            z-index: 10;
            box-shadow: 0 18px 34px rgba(0, 0, 0, 0.25);
            text-align: center;
            margin-bottom: 24px;
        }
        
        .header-wrap {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 18px;
        }
        
        .header-wrap img {
            height: 78px;
        }
        
        .header-center {
            flex: 1;
            text-align: center;
            margin: 0 12px;
        }
        
        .title {
            font-weight: 800;
            font-size: 20px;
            margin: 0;
        }
        
        .sub {
            font-size: 17px;
            margin-top: 3px;
        }
        
        .grid {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            text-align: center;
        }
        
        .field.full {
            flex-basis: 100%!important;
            width: 100%;
            text-align: center;
        }
        
        .field {
            flex: 1 1 44%;
            min-width: 220px;
            text-align: center;
        }
        
        .label-small {
            font-size: 13px;
            color: #555;
            margin-bottom: 4px;
            text-align: center;
        }
        
        .value {
            font-size: 16px;
            font-weight: 700;
            padding-bottom: 8px;
            border-bottom: 1px solid #ddd;
            color: #111;
            word-break: break-word;
            text-align: center;
        }
        
        .download-row {
            display: flex;
            justify-content: center;
            margin-top: 24px;
            gap: 10px;
        }
        /* Envolve o card em um container próprio */
        
        .card-wrapper {
            width: 100%;
            display: flex;
            justify-content: center;
        }
        /* Mantém proporção do card e define largura base */
        
        #reportCard {
            transform-origin: top center;
            width: 600px;
            /* largura base */
        }
    </style>
</head>

<body>
    <div class="app">

        <!-- FORMULÁRIO -->
        <div class="form" id="form">

            <div class="form-row">
                <div class="col">
                    <label>Nome</label>
                    <input id="nome" type="text">
                </div>
            </div>

            <div class="form-row">
                <div class="col">
                    <label>Unidade</label>
                    <input id="unidade" type="text" placeholder="EQUIPE CFP NOTURNA">
                </div>
                <div class="col">
                    <label>RG</label>
                    <input id="rg" type="text">
                </div>
            </div>

            <div class="form-row">
                <div class="col">
                    <label>Nascimento</label>
                    <input id="nascimento" type="date">
                </div>
                <div class="col">
                    <label>Ocorrência</label>
                    <input id="ocorrencia" type="text">
                </div>
            </div>

            <div class="form-row">
                <div class="col">
                    <label>Local</label>
                    <input id="local" type="text">
                </div>
                <div class="col">
                    <label>BOPM</label>
                    <input id="bopm" type="text">
                </div>
            </div>

            <div class="col">
                <label>Viatura</label>
                <input id="viatura" type="text">
            </div>

            <div class="form-row">
                <div class="col">
                    <label>Equipe</label>
                    <input id="equipe" type="text">
                </div>
            </div>

            <div class="form-row">
                <div class="col">
                    <label>BOPC</label>
                    <input id="bopc" type="text">
                </div>
                <div class="col">
                    <label>Data</label>
                    <input id="data" type="date">
                </div>
            </div>

            <div class="form-row">
                <div class="col">
                    <label>Foto principal</label>
                    <input id="imgInput" type="file" accept="image/*">
                </div>
            </div>

            <div class="actions">
                <button id="btnPreview">Atualizar Prévia</button>
                <button id="btnClear" class="secondary">Limpar</button>
            </div>

        </div>
        <div class="card-wrapper">
            <div id="reportCard">
                <!-- conteúdo do seu cartão -->
            </div>
        </div>


        <!-- PREVIEW -->
        <div class="preview" id="previewArea"> <img id="photo" class="photo">
            <div id="reportCard" class="card">
                <div class="header-wrap"> <img src="img/logo22.png">
                    <div class="header-center">
                        <div class="title">POLÍCIA MILITAR DO ESTADO DE SÃO PAULO</div>
                        <div id="r_unidade" class="sub">EQUIPE CFP NOTURNA</div>
                    </div> <img src="img/logopm.png"> </div>
                <div class="grid">

                    <div class="field full">
                        <div class="label-small">Nome:</div>
                        <div id="r_nome" class="value"></div>
                    </div>

                    <div class="field">
                        <div class="label-small">RG:</div>
                        <div id="r_rg" class="value"></div>
                    </div>

                    <div class="field">
                        <div class="label-small">Nascimento:</div>
                        <div id="r_nascimento" class="value"></div>
                    </div>

                    <div class="field">
                        <div class="label-small">Ocorrência:</div>
                        <div id="r_ocorrencia" class="value"></div>
                    </div>

                    <div class="field">
                        <div class="label-small">Local:</div>
                        <div id="r_local" class="value"></div>
                    </div>

                    <div class="field">
                        <div class="label-small">BOPM:</div>
                        <div id="r_bopm" class="value"></div>
                    </div>

                    <div class="field">
                        <div class="label-small">BOPC:</div>
                        <div id="r_bopc" class="value"></div>
                    </div>

                    <div class="field">
                        <div class="label-small">Viatura:</div>
                        <div id="r_viatura" class="value"></div>
                    </div>

                    <div class="field">
                        <div class="label-small">Equipe:</div>
                        <div id="r_equipe" class="value"></div>
                    </div>

                    <div class="field full">
                        <div class="label-small">Data:</div>
                        <div id="r_data" class="value"></div>
                    </div>

                </div>

            </div>
        </div>

        <!-- DOWNLOAD -->
        <div class="download-row">
            <button id="btnDownload">Baixar JPEG</button>
            <button id="btnDownloadPDF" class="secondary">Abrir em PDF</button>
        </div>

    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <script>
        const elems = {
            unidade,
            nome,
            rg,
            nascimento,
            ocorrencia,
            local,
            bopm,
            bopc,
            viatura,
            equipe,
            data,
            imgInput,
            photo,
            previewArea
        };

        const targets = {
            r_unidade,
            r_nome,
            r_rg,
            r_nascimento,
            r_ocorrencia,
            r_local,
            r_bopm,
            r_bopc,
            r_viatura,
            r_equipe,
            r_data
        };

        function formatDate(iso) {
            if (!iso) return "";
            const p = iso.split("-");
            return `${p[2]}/${p[1]}/${p[0]}`;
        }

        function atualizarPreview() {
            targets.r_unidade.textContent = elems.unidade.value || "EQUIPE CFP NOTURNA";
            targets.r_nome.textContent = elems.nome.value;
            targets.r_rg.textContent = elems.rg.value;
            targets.r_nascimento.textContent = elems.nascimento.value ? formatDate(elems.nascimento.value) : "";
            targets.r_ocorrencia.textContent = elems.ocorrencia.value;
            targets.r_local.textContent = elems.local.value;
            targets.r_bopm.textContent = elems.bopm.value;
            targets.r_bopc.textContent = elems.bopc.value;
            targets.r_viatura.textContent = elems.viatura.value;
            targets.r_equipe.textContent = elems.equipe.value;
            targets.r_data.textContent = elems.data.value ? formatDate(elems.data.value) : "";
        }

        document.querySelectorAll("#form input").forEach(input =>
            input.addEventListener("input", atualizarPreview)
        );

        imgInput.addEventListener("change", e => {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = ev => photo.src = ev.target.result;
            reader.readAsDataURL(file);
        });

        btnClear.addEventListener("click", () => {
            document.querySelectorAll('#form input[type=text], #form input[type=date]').forEach(i => i.value = "");
            imgInput.value = "";
            photo.src = "";
            atualizarPreview();
        });

        async function captureNodeAsBlob(node, scale = 3) {
            await new Promise(r => setTimeout(r, 150));

            const canvas = await html2canvas(node, {
                scale,
                useCORS: true,
                allowTaint: false,
                backgroundColor: null
            });

            return new Promise(resolve =>
                canvas.toBlob(blob => resolve(blob), "image/jpeg", 0.92)
            );
        }

        btnDownload.addEventListener("click", async() => {
            const blob = await captureNodeAsBlob(previewArea, 3);
            if (!blob) return alert("Erro ao gerar imagem.");

            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "relatorio_pm.jpeg";
            a.click();
            URL.revokeObjectURL(url);
        });

        btnDownloadPDF.addEventListener("click", async() => {
            const blob = await captureNodeAsBlob(previewArea, 2);
            if (!blob) return alert("Erro ao gerar imagem.");

            const url = URL.createObjectURL(blob);
            const w = window.open("", "_blank");
            w.document.write(`<img src="${url}" style="width:100%">`);
            w.document.close();
        });

        atualizarPreview();

        function scaleCard() {
            const card = document.getElementById("reportCard");
            const containerWidth = window.innerWidth;

            const baseWidth = 600; // largura original do card
            const scale = Math.min(containerWidth / baseWidth, 1);

            card.style.transform = `scale(${scale})`;
        }

        window.addEventListener("load", scaleCard);
        window.addEventListener("resize", scaleCard);
    </script>

</body>

</html>
